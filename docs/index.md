# Программно-определяемая камера

## Общие сведения

Проект **sdcam** (sdcam&nbsp;– Software-Defined Camera) является основой платформы для построения программно-определяемых видеотрактов камер различных диапазонов длин волн.

Основная идея данного подхода заключается в переносе реализации тракта обработки видеопотока с **аппаратного** уровня внутри прибора на **программный** уровень рабочей станции разработчика. Это резко&nbsp;– на порядки&nbsp;– упрощает процесс разработки и отладки алгоритмов обработки сигналов видеопотока, получаемого от детекторов теплового излучения или сенсоров видимого диапазона, а также делает процесс практического исследования свойств источников сигнала намного более эффективным.

### Мотивация

Описанные выше обстоятельства являются объективным следствием того, что процесс реализации видеотракта средствами аппаратуры прибора является значительно более сложным и трудоёмким, нежели аналогичное решение в виде программы на языке высокого уровня (ЯВУ). Это связано с тем, что технические особенности аппаратной части приборов являются существенно иными по сравнению с рабочей станцией разработчика.

#### Аспекты проектирования и разработки

##### Технологический

Проектирование и реализация собственно видеотракта в приборе как правило реализуется на FPGA, что даёт эффективность (производительность, обеспечивающую стабильную работу в масштабе реального времени, при низком или умеренном энергопотреблении и небольших габаритах), но сам по себе процесс разработки с использованием FPGA является весьма непростым и трудоёмким&nbsp;– тут необходимо разработать специализированную аппаратуру на HDL (Hardware Description Language), проверить (верифицировать) правильность её функционирования, что требует разработки соответствующего тестового ПО (тестбенчи, референсные модели и другое верификационное окружение) с последующим прогоном тестируемого HDL-описания в составе тестового окружения на HDL-симуляторе.

При этом неизбежно выявляются ошибки, осуществляется процесс их исправления, повторные прогоны до достижения корректной работы спроектированного дизайна. Всё это занимает значительное время, требует усилий и в совокупности с целевой разработкой (аппаратуры видеотракта)&nbsp;– конвейера, через который проходит поток пикселов, представляет собой весьма трудоёмкий и небыстрый процесс.

##### Исследовательский

Исследования требуют возможность иметь непосредственный доступ к содержимому видеопотока, дабы оценивать его параметры (величину сигнала, шумы, распределение значений и т.п.), а также возможности оперативно управлять аппаратурой прибора с целью выявления зависимости ряда параметров сигнала от управляющих воздействий. Всё это необходимо для построения адекватной поведенческой модели источника сигнала (детектора/сенсора излучения) с целью разработки эффективных алгоритмов управления аппаратурой прибора и обработки получаемого видеопотока.

Традиционный подход предполагает разработку в составе прибора специальных средств, позволяющих сохранять фрагменты видеопотока. Как правило это реализуется внутри аппаратуры на свободных ресурсах&nbsp;– т.е. по сути здесь приходится вести точно такую же разработку с использованием FPGA и ембеддед процессора, только в отличие от целевой разработки эта представляет собой *в чистом виде накладные расходы* и по использованию ресурсов прибора, и по трудозатратам.

##### Алгоритмический

Алгоритмический аспект сводится к вопросам построения тракта обработки сигналов. Здесь разработчика поджидает ряд трудностей, связанных с неопределённостью влияния тех или иных алгоритмов на результат: сложно предсказать до реализации и практической оценки, какой метод или приём даст лучший результат в том или ином контексте&nbsp;– достоверность достигается только путём реализации и проверки на практике. Учитывая трудоёмкость реализации, техническое исполнение каждого варианта является достаточно затратным&nbsp;– приходится тратить несколько недель (а то и месяцев) на реализацию очередного варианта, который на практике может показать далеко не лучше результаты.

#### Итог

Вышеописанные проблемы технологического, исследовательского и алгоритмического плана делают подход на основе программно-определяемой камеры очень востребованным, т.к. он эффективно решает их все:

  * технология разработки тракта на ЯВУ является намного более простой и быстрой как в смысле
    скорости написания реализации (кодирования), так и в смысле сборки (синтез с последующими
    размещением и разводкой связей внутри FPGA выходит значительно более долгим, нежели компиляция
    аналогичного по сложности проекта, например, на **С++**, не говоря уже о запуске программы на интерпретируемом языке вроде **Python**), а отладка реализации более простой и
    доступной (отладочная печать в логи, инспекция внутренних переменных практически без
    ограничений и т.п.);
  * исследования видеосигналов делаются относительно несложными, т.к. все данных находятся в памяти
    рабочей станции разработчика, откуда могут быть легко извлечены для анализа, а управление
    аппаратурой прибора достаточно просто осуществляется посредством "стандартных" аппаратных
    интерфейсов и протоколов, имеющих хорошую поддержку со стороны хоста;
  * реализация алгоритмов также является вполне ординарной задачей по написанию программы на ЯВУ,
    что позволяет в относительно короткие сроки создавать различные варианты обработки сигналов и иметь возможность оперативно сравнивать практические результаты.

## Назначение

Платформа **sdcam** может использоваться:

  * как основа для исследовательских стендов, предназначенных для работы с видеосигналами;
  * для реализации полноценного тракта обработки видеосигналов, пригодного как объект моделирования
    алгоритмов обработки сигналов с целью последующего переноса этих алгоритмов на аппаратуру
    целевого прибора, так и самостоятельного решения в виде программно-аппаратного комплекса;
  * как тестовый стенд для производственных целей, позволяющий эффективно автоматизировать операции
    про проверке и настройке серийно изготавливаемых приборов.

## Реализация

Реализация в своей сути проста как и сама идея: аппаратура видеотракта прибора переводится в "прозрачный" (bypass) режим, при котором весь поток пикселов от источника (детектора/сенсора излучения) передаётся без изменений на рабочую станцию разработчика посредством аппаратного интерфейса. Программное обеспечение (ПО) рабочей станции реализует всю необходимую функциональность по всем трём аспектам.

В качестве интерфейса может выступать какой-либо из стандартных: USB, Ethernet. Наиболее перспективным выглядит 1GbE (1000T-Base) в виду дешевизны, технической доступности и благодаря хорошей поддержке со стороны как ембеддед ПО, так и ПО хоста. При этом скорости этого интерфейса с запасом хватает для передачи "сырого" видеопотока без сжатия.

Реализация программно-определяемого канала обработки средствами ЯВУ подробно описана в последующих разделах.